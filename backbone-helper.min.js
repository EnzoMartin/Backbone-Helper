!function(a,b){if("function"==typeof define&&define.amd)define(["backbone","underscore","exports"],function(c,d,e){return b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("backbone"),d=require("underscore");module.exports=b(a,exports,c,d)}else a.BB=b(a,{},a.Backbone,a._)}(this,function(a,b,c){function d(a,b){var c,d=this[a+"_instances"],f=b.name,g="undefined"!=typeof d[f];return b.reset&&g?("model"==a?d[f].destroy():"collection"==a&&d[f].reset(),delete d[f],c=e.call(this,a,b)):c=g?d[f]:e.call(this,a,b),c}function e(a,b){var c,d=this[a+"_definitions"],e=b.name,f="undefined"!=typeof d[e];if(!f)throw new Error(a+" definition not found: "+e+". Did you add it to the BB."+a+"_definitions object?");if(c=this[a+"_instances"][e]=new d[e](b.data||null),b.options)for(var g in b.options){var h=b.options[g];c[g]=h}return c.name=e,"model"==a&&this[a+"_instances"][e].on("destroy",function(){delete this[a+"_instances"][e]},this),c}b={view_definitions:{},model_definitions:{},collection_definitions:{},view_instances:{},model_instances:{},collection_instances:{}},b.get_model=function(a){return"undefined"==typeof a.name&&(a={name:a}),d.call(this,"model",a)},b.get_collection=function(a){return"undefined"==typeof a.name&&(a={name:a}),d.call(this,"collection",a)},b.get_view=function(a,b,c){"undefined"==typeof a.name&&(a={name:a});var d=this.view_instances,e=a.name;return a.reset&&d[e]&&d[e].remove(),d[e]?d[e]:this.create_view(a,b,c)},b.create_view=function(a,b,d){var e=a.name,f=this.view_definitions[e],g=!b||b instanceof c.Model?b:this.get_model(b),h=!d||d instanceof c.Collection?d:this.get_collection(d);if(f=f?this.view_instances[e]=new f({model:g,collection:h}):"",a.options)for(var i in a.options){var j=a.options[i];f[i]=j}return this.view_instances[e].on("remove",function(){delete this.view_instances[e]},this),f.name=e,f},b.get=function(a){var b;return a.view?b=this.get_view(a.view,a.model,a.collection):a.model?b=this.get_model(a.model):a.collection&&(b=this.get_collection(a.collection)),b},b.exists=function(a,b){return"undefined"!=typeof this[a+"_instances"][b]};var f=c.View.prototype.remove;return c.View.prototype.remove=function(){return this.trigger("remove"),f.apply(this,arguments)},b});